---
layout: post
title: "存储基础知识"
subtitle: ''
comments: false
author: "Gump"
header-style: text
date: 2020-3-20 20:30:21 +0800
tags:
    - 存储 
    - 笔记
---





# 存储基础知识



## 发展历程

### 文件存储

优点：简单

缺点：

- 寻址时间长，时间在ms级别（s>ms>us>ns）; 内存的寻址时间在ns
- 带宽大小限制，一般是百兆带宽；
- 查找时需要全量IO

### 关系型数据库

整体优点：利用索引+dataPage块 机制避免了全量文件IO

整体缺点：由于事务、join查询等设计造成关系型很难横向扩展；分库分表后面临两大难题：分布式事务和跨库关联查询

| 名称              | 优点                                                         | 缺点                                             | 地址                                                         |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------ | ------------------------------------------------------------ |
| Oracle            | 企业级数据库，查询数据快，特别是join查询比Mysql性能好很多    | 价格贵                                           |                                                              |
| Mysql             | 免费                                                         | join查询性能差，尽量少用，最多不要超过三张表join |                                                              |
| SAP HANA          | 全内存关系型数据库，速度特别快                               | 价格特别贵，内存大主机要定制                     |                                                              |
| 蚂蚁金服OceanBase | 通过Paxos算法实现了高可用、强一致性；通过分区表实现了透明扩展 | 收费，对外只通过阿里云提供服务                   | https://help.aliyun.com/document_detail/135044.html?spm=a2c4g.11186623.6.544.4496151enEwELg |
| 腾讯TDSQL         | 通过Paxos算法实现了高可用、强一致性；通过改进的XA协议实现分布式事务；通过sharding方式实现透明扩展 | 收费，对外通过腾讯云提供服务                     | https://cloud.tencent.com/document/product/557/7700          |

**关系型数据库突破单机限制上的一些努力**

1.突破单机CPU、内存的限制

  1）使用小型机，超多核CPU、超大内存 ；优点：简单 ;缺点：价钱贵

  2）分库 优点：容易水平扩展；缺点：负责，借助shardingJDBC等 关联查询困难（借助nosql） 跨库事物难（尽量避免,最终一致）

   2.1） 代理的方式实现分库 shardingJDBC

   2.2)  数据库自身实现 TIDB CouchDB

2.突破存储限制

  1）分表；优点：单独的数据文件；可以指定存储位置，突破单磁盘容量限制；主要用来提升单表的并发能能力；缺点：受限单机磁盘可扩展磁盘数量限制，查询复杂

   1.1）mysql自身支持的Merge分表，特点：简单，存储引擎需要是MyIsam,不支持事物，不需要修改应用层代码

   1.2) 代理方式 shardingJDBC；中间件实现查询聚合（通过union）,跨表join需要通过nosql；特点：实现复杂

  2）分区；优点：对外表现还是一张表，查询等同单表查询；可以指定各分区存储位置，突破单磁盘容量限制；主要用来提升单表存储能力；缺点：受限单机磁盘可扩展磁盘数量限制；

  并发请求高，数据量大用分表；并发请求低，数据量大用分区

  3）分库 ；同1分库

### Key-Value数据库

整体优点：全内存型数据库，避免了磁盘寻址和网络带传输，速度特别快；容易横向扩展

整体缺点：不支持事务；内存大小限制不适合存储大量数据，即使横向扩展建立集群后，整体内存空间还是比较小

| 名称     | 优点                                                         | 缺点                                            |
| -------- | ------------------------------------------------------------ | ----------------------------------------------- |
| Reids    | value有类型，针对不同类型提供了丰富的操作接口，避免了把全部value取到客户端再处理； |                                                 |
| Memcache |                                                              | value没有类型，每次只能根据key取全量的value回来 |
|          |                                                              |                                                 |

### 文档型数据库

整体优点：可以用来存海量数据，可以做结构化查询，可以做数据分析

整体缺点：不支持事务，不支持join查询

| 名称                      | 使用场景   | 缺点 |
| ------------------------- | ---------- | ---- |
| MongoDB(主文档、次搜索)   | 存业务日志 |      |
| Elastic（主搜索、次文档） |            |      |
|                           |            |      |



### 搜索数据库

### 图数据库

### 列数据库

HBASE

