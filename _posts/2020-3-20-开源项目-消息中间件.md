---
layout: post
title: "消息中间件"
subtitle: ''
comments: false
author: "Gump"
header-style: text
date: 2020-3-20 20:30:21 +0800
tags:
    - 开源项目
    - 中间件
    - 笔记
---

### RocketMq

#### 顺序消息
消息发送到同一个队列中，不是同一个topic，一个topic默认有四个队列
#### 事物消息
先预发消息，本地事物执行成功后，再发确认消息；确认消息发送失败还有一个回调查询事物状态
#### 广播消息
Rocketmq 消费者默认是集群的方式消费的，消费者还可以用广播的模式进行消费
consumer.setMessageModel(MessageModel.BROADCASTING);

### 非事物消息问题
```
 数据库操作1
 数据库操作2
 发消息
```
可能出现消息发送成功之后，本地事物没有提交成功
没有事物消息场景下解决方案：在事物外控制层发消息，发消息失败通过job扫描确保消息发送成功

## RocketMq RabbitMq对比

|          | 广播模式                                                  | 订阅模式（单机）                                  | 订阅模式（集群）                                  | 订阅模式（多集群）                                           | 备注                                                         |
| -------- | --------------------------------------------------------- | ------------------------------------------------- | ------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| RabbitMq | Exchange：fanout                                          | Exchange：direct                                  | Exchange：direct 相同集群下集群绑定相同的queue    | Exchange：direct 相同集群下集群绑定相同的queue,不同的机器侠机器绑定不同的queue |                                                              |
| RocketMq | 不同ConsumerGroup订阅相同Topic,然后Consumer设置为广播模式 | ConsumerGroup订阅Topic,然后Consumer设置为集群模式 | ConsumerGroup订阅Topic,然后Consumer设置为集群模式 | 不同ConsumerGroup订阅相同Topic,然后Consumer设置为集群模式    | 广播和集群说明：https://help.aliyun.com/document_detail/43163.html?spm=a2c4g.11186623.6.558.8cd61d70zzU54W |
|          |                                                           |                                                   |                                                   |                                                              |                                                              |

